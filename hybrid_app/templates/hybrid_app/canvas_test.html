<!DOCTYPE html>

<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.2.0/fabric.min.js"></script>
</head>

<body>

<canvas id="canvas"></canvas>

<button onClick="toggleMode(modes.pan)">Pan</button>
<button onClick="toggleMode(modes.drawing)">Drawing</button>

<script>
  // const canvas = new fabric.Canvas("canvas", {
  //   width: 500,
  //   height: 500,
  // });
  //
  // canvas.renderAll();

  const initCanvas = (id) => {
    return new fabric.Canvas(id, {
      width: 500,
      height: 500,
      backgroundColor: 'lightsteelblue',
      selection: false,
    });
  }

  const toggleMode = (mode) => {
    if (mode === modes.pan) {
      if (currentMode === modes.pan) {
        currentMode = '';
        canvas.setCursor('default')
        canvas.renderAll()
      } else {
        currentMode = modes.pan;
        canvas.isDrawingMode = false;
        canvas.renderAll();
      }
    } else if (mode === modes.drawing) {
      if (currentMode === modes.drawing) {
        currentMode = '';
        canvas.isDrawingMode = false;
        canvas.renderAll();
      } else {
        currentMode = modes.drawing;
        canvas.isDrawingMode = true;
        canvas.renderAll();
      }
    }
    console.log(mode);
  }

  const setPanEvents = (canvas) => {
    canvas.on('mouse:move', (event) => {
      if (currentMode === modes.pan) {
        canvas.setCursor('grab')
        canvas.renderAll()
      }
      if (mousePressed && currentMode === modes.pan) {
        const mEvent = event.e;
        const delta = new fabric.Point(mEvent.movementX, mEvent.movementY)
        canvas.relativePan(delta);
      } else if (mousePressed && currentMode === modes.drawing) {
        // canvas.isDrawingMode = true;
        // canvas.renderAll();
      }
    })

    canvas.on('mouse:down', (event) => {
      mousePressed = true;
    })

    canvas.on('mouse:up', (event) => {
      mousePressed = false;
    })
  }

  const canvas = initCanvas('canvas');

  let mousePressed = false;

  let currentMode;
  const modes = {
    pan: 'pan',
    drawing: 'drawing'
  }

  var rectangle = new fabric.Rect({
    width: 200,
    height: 100,
    left: 100,
    top: 100,
    fill: 'steelblue',
  });

  canvas.add(rectangle);

  setPanEvents(canvas);
</script>

</body>

</html>
